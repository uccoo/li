<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="google-site-verification" content="46azurDV6ghykBQF8wLVWeLTuDNbMq-p6DrpqZROFlE">
<meta name="baidu-site-verification" content="qioyGQqYYq">









  <meta name="google-site-verification" content="true">







  <meta name="baidu-site-verification" content="true">









<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.1.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="#作业在这里 123456789101112131415161718192021222324252627282930rm(list = ls()) options()$repos options()$BioC_mirroroptions(BioC_mirror=&amp;quot;https://mirrors.ustc.edu.cn/bioc/&amp;quot;)options(&amp;quot;repos&amp;quo">
<meta name="keywords" content="R,统计,生物信息学">
<meta property="og:type" content="article">
<meta property="og:title" content="生信技能树R作业答案-中级">
<meta property="og:url" content="https://hyinli.github.io/2019/04/27/生信技能树R作业中级/index.html">
<meta property="og:site_name" content="K1 biogithub">
<meta property="og:description" content="#作业在这里 123456789101112131415161718192021222324252627282930rm(list = ls()) options()$repos options()$BioC_mirroroptions(BioC_mirror=&amp;quot;https://mirrors.ustc.edu.cn/bioc/&amp;quot;)options(&amp;quot;repos&amp;quo">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-05-01T10:25:40.673Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="生信技能树R作业答案-中级">
<meta name="twitter:description" content="#作业在这里 123456789101112131415161718192021222324252627282930rm(list = ls()) options()$repos options()$BioC_mirroroptions(BioC_mirror=&amp;quot;https://mirrors.ustc.edu.cn/bioc/&amp;quot;)options(&amp;quot;repos&amp;quo">



  <link rel="alternate" href="/atom.xml" title="K1 biogithub" type="application/atom+xml">



  
  
  <link rel="canonical" href="https://hyinli.github.io/2019/04/27/生信技能树R作业中级/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>生信技能树R作业答案-中级 | K1 biogithub</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">K1 biogithub</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">只做两件事</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">6</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">21</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">15</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-links">

    
    
    
      
    

    
      
    

    <a href="/links/" rel="section"><i class="menu-item-icon fa fa-fw fa-paperclip"></i> <br>友链</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    
  
  

  

  <a href="https://github.com/hyinli" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewbox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a>



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hyinli.github.io/2019/04/27/生信技能树R作业中级/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kelly">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="K1 biogithub">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">生信技能树R作业答案-中级

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-27 20:10:13" itemprop="dateCreated datePublished" datetime="2019-04-27T20:10:13+08:00">2019-04-27</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-05-01 18:25:40" itemprop="dateModified" datetime="2019-05-01T18:25:40+08:00">2019-05-01</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">13k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">12 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>#<a href="http://www.bio-info-trainee.com/3750.html" target="_blank" rel="noopener">作业在这里</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">rm(list = ls()) </span><br><span class="line">options()$repos </span><br><span class="line">options()$BioC_mirror</span><br><span class="line">options(BioC_mirror=&quot;https://mirrors.ustc.edu.cn/bioc/&quot;)</span><br><span class="line">options(&quot;repos&quot; = c(CRAN=&quot;https://mirrors.tuna.tsinghua.edu.cn/CRAN/&quot;))</span><br><span class="line">options()$repos </span><br><span class="line">options()$BioC_mirror</span><br><span class="line"># https://bioconductor.org/packages/release/bioc/html/GEOquery.html</span><br><span class="line">if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE))</span><br><span class="line">  install.packages(&quot;BiocManager&quot;)</span><br><span class="line">BiocManager::install(&quot;KEGG.db&quot;,ask = F,update = F)</span><br><span class="line">BiocManager::install(c(&quot;GSEABase&quot;,&quot;GSVA&quot;,&quot;clusterProfiler&quot; ),ask = F,update = F)</span><br><span class="line">BiocManager::install(c(&quot;GEOquery&quot;,&quot;limma&quot;,&quot;impute&quot; ),ask = F,update = F)</span><br><span class="line">BiocManager::install(c(&quot;genefu&quot;,&quot;org.Hs.eg.db&quot;,&quot;hgu133plus2.db&quot; ),ask = F,update = F)</span><br><span class="line">options()$repos</span><br><span class="line">install.packages(&apos;WGCNA&apos;)</span><br><span class="line">install.packages(c(&quot;FactoMineR&quot;, &quot;factoextra&quot;))</span><br><span class="line">install.packages(c(&quot;ggplot2&quot;, &quot;pheatmap&quot;,&quot;ggpubr&quot;))</span><br><span class="line">library(&quot;FactoMineR&quot;)</span><br><span class="line">library(&quot;factoextra&quot;)</span><br><span class="line">library(GSEABase)</span><br><span class="line">library(GSVA)</span><br><span class="line">library(clusterProfiler)</span><br><span class="line">library(genefu)</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(ggpubr)</span><br><span class="line">library(hgu133plus2.db)</span><br><span class="line">library(limma)</span><br><span class="line">library(org.Hs.eg.db)</span><br><span class="line">library(pheatmap)</span><br></pre></td></tr></table></figure>
<h1 id="task1-通过r注释包从ensemble到symbol"><a class="markdownIt-Anchor" href="#task1-通过r注释包从ensemble到symbol"></a> Task1: 通过R注释包从ensemble到symbol</h1>
<blockquote>
<p>请根据R包org.Hs.eg.db找到下面ensembl 基因ID 对应的基因名(symbol)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># ENSG00000000003.13</span><br><span class="line"># ENSG00000000005.5</span><br><span class="line"># ENSG00000000419.11</span><br><span class="line"># ENSG00000000457.12</span><br><span class="line"># ENSG00000000460.15</span><br><span class="line"># ENSG00000000938.11</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">library(org.Hs.eg.db)</span><br><span class="line">ls(&quot;package:org.Hs.eg.db&quot;)</span><br><span class="line">g2s &lt;- toTable(org.Hs.egSYMBOL)</span><br><span class="line">g2e &lt;- toTable(org.Hs.egENSEMBL)</span><br><span class="line">head(g2s)</span><br><span class="line">head(g2e)</span><br><span class="line">g2se &lt;- merge(g2s, g2e, by=&apos;gene_id&apos;)</span><br><span class="line">head(g2se)</span><br><span class="line">ensID1 &lt;- c(&quot;ENSG00000000003.13&quot;,&quot;ENSG00000000005.5&quot;,&quot;ENSG00000000419.11&quot;,</span><br><span class="line">           &quot;ENSG00000000457.12&quot;,&quot;ENSG00000000460.15&quot;,&quot;ENSG00000000938.11&quot;)</span><br><span class="line">ensID &lt;- data.frame(ensID1)</span><br></pre></td></tr></table></figure>
<h2 id="method1for循环"><a class="markdownIt-Anchor" href="#method1for循环"></a> Method1:for循环</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">for (i in 1:nrow(ensID)) &#123;</span><br><span class="line">  ens_i &lt;- strsplit(as.character(ensID[i,1]),&apos;.&apos;,fixed = TRUE)[[1]][1]</span><br><span class="line">  ensID[i,2]&lt;-ens_i</span><br><span class="line">&#125;</span><br><span class="line">ensID$ensembl_id  &lt;- NULL</span><br><span class="line">colnames(ensID)[1] &lt;- &apos;ensembl_id&apos; </span><br><span class="line">ensID_last &lt;- merge(ensID, g2se, &apos;ensembl_id&apos;)</span><br><span class="line">ensID_last</span><br></pre></td></tr></table></figure>
<h2 id="method2apply函数"><a class="markdownIt-Anchor" href="#method2apply函数"></a> Method2:apply函数</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ensID$ensembl_id &lt;- unlist(lapply(ensID1,  function(x) &#123;strsplit(as.character(x),&apos;.&apos;,fixed = TRUE)[[1]][1]</span><br><span class="line">  &#125;))</span><br><span class="line">ensID_last2 &lt;- merge(ensID, g2se,&quot;ensembl_id&quot;)</span><br></pre></td></tr></table></figure>
<h1 id="task2由探针找到对应的基因名"><a class="markdownIt-Anchor" href="#task2由探针找到对应的基因名"></a> Task2:由探针找到对应的基因名</h1>
<blockquote>
<p>根据R包hgu133a.db找到下面探针对应的基因名(symbol)<br>
053_at<br>
117_at<br>
121_at<br>
1255_g_at<br>
1316_at<br>
1320_at<br>
1405_i_at<br>
1431_at<br>
1438_at<br>
1487_at<br>
1494_f_at<br>
1598_g_at<br>
160020_at<br>
1729_at<br>
177_at</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">library(hgu133a.db)</span><br><span class="line">ids &lt;- toTable(hgu133aSYMBOL)</span><br><span class="line">head(ids)</span><br><span class="line">myids &lt;- read.table(file = &quot;my_probe_ids.txt&quot;)</span><br><span class="line">colnames(myids) &lt;- &quot;probe_id&quot;</span><br><span class="line">myid_sym &lt;- merge(myids, ids, by=&quot;probe_id&quot;)</span><br><span class="line">head(myid_sym)</span><br></pre></td></tr></table></figure>
<h1 id="task3-找某个基因在表达矩阵中的值并分组绘图"><a class="markdownIt-Anchor" href="#task3-找某个基因在表达矩阵中的值并分组绘图"></a> Task3 找某个基因在表达矩阵中的值并分组绘图</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 找到R包CLL内置的数据集的表达矩阵里面的TP53基因的表达量，并且绘制在 progres.-stable分组的boxplot图</span><br><span class="line"># 提示：</span><br><span class="line"># suppressPackageStartupMessages(library(CLL))</span><br><span class="line"># data(sCLLex)</span><br><span class="line"># sCLLex</span><br><span class="line"># exprSet=exprs(sCLLex)   </span><br><span class="line"># library(hgu95av2.db)</span><br></pre></td></tr></table></figure>
<p>以下是代码部分</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rm(list=ls())</span><br><span class="line">library(CLL)</span><br><span class="line">data(sCLLex)</span><br><span class="line">expr &lt;- exprs(sCLLex)</span><br><span class="line">pdata &lt;- pData(sCLLex)</span><br><span class="line">head(expr)</span><br><span class="line">library(hgu95av2.db)</span><br><span class="line">probe_sym &lt;- toTable(hgu95av2SYMBOL)</span><br><span class="line">tp53_probes &lt;- probe_sym[grep(&quot;TP53$&quot;, probe_sym$symbol),]</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># probe_id symbol</span><br><span class="line"># 966    1939_at   TP53</span><br><span class="line"># 997  1974_s_at   TP53</span><br><span class="line"># 1420  31618_at   TP53</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boxplot(expr[&apos;1939_at&apos;,]~pdata$Disease)</span><br></pre></td></tr></table></figure>
<p>ggpubr<br>
<a href="http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/" target="_blank" rel="noopener">http://www.sthda.com/english/articles/24-ggpubr-publication-ready-plots/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">library(ggpubr)</span><br><span class="line">tp53_pub &lt;- cbind(expr[&apos;1939_at&apos;,], as.data.frame(pdata$Disease))</span><br><span class="line">colnames(tp53_pub) &lt;- c(&apos;Expression&apos;,&quot;Group&quot;)</span><br><span class="line">p &lt;- ggboxplot(tp53_pub, y=&apos;Expression&apos;, x=&apos;Group&apos;,fill = &apos;Group&apos;, </span><br><span class="line">            palette = &apos;aaas&apos; ,add = &apos;jitter&apos;)</span><br><span class="line"># &quot;npg&quot;, &quot;aaas&quot;, &quot;lancet&quot;, &quot;jco&quot;, &quot;ucscgb&quot;, &quot;uchicago&quot;, &quot;simpsons&quot; &quot;rickandmorty&quot;</span><br><span class="line">p + stat_compare_means()</span><br><span class="line">p + stat_compare_means(method = &apos;t.test&apos;)</span><br><span class="line">#the violin plot</span><br><span class="line">my_comparisons &lt;- list(c(&quot;progress.&quot;, &quot;stable&quot;))</span><br><span class="line">ggviolin(tp53_pub, y=&apos;Expression&apos;, x=&apos;Group&apos;,fill = &apos;Group&apos;, </span><br><span class="line">         palette = &apos;aaas&apos; ,add = &apos;boxplot&apos;, add.params = list(fill = &apos;white&apos;))+</span><br><span class="line">         stat_compare_means(comparisons = my_comparisons, method = &quot;t.test&quot;)+</span><br><span class="line">         stat_compare_means(label.y = 5)</span><br></pre></td></tr></table></figure>
<h1 id="task4对任意肿瘤的任意基因进行分类做图用cbioportal"><a class="markdownIt-Anchor" href="#task4对任意肿瘤的任意基因进行分类做图用cbioportal"></a> Task4:对任意肿瘤的任意基因进行分类做图（用cBioPortal）</h1>
<blockquote>
<p>cbioportal下载，即利用在线数据（下载），本地进行改观<br>
<a href="http://www.cbioportal.org/index.do" target="_blank" rel="noopener">http://www.cbioportal.org/index.do</a><br>
Select Studies 选项中输入Breast Invasive Carcinoma PanCancer 搜索并选中目标数据集<br>
Enter Genes 数据框中输入目标基因BRCA1<br>
点击Submit Query提交搜索请求<br>
结果页面中，Plots选项卡选择合适数据进行绘图，或下载数据</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rm(list = ls())</span><br><span class="line">options(stringsAsFactors = F)</span><br><span class="line">a=read.table(&apos;e4-plot.txt&apos;,sep = &apos;\t&apos;,fill = T,header = T)</span><br><span class="line">View(a)</span><br><span class="line">colnames(a)=c(&apos;id&apos;,&apos;subtype&apos;,&apos;expression&apos;,&apos;mut&apos;)</span><br><span class="line">dat=a</span><br><span class="line">library(ggstatsplot)</span><br><span class="line">ggbetweenstats(data =dat, x = subtype,  y = expression)</span><br><span class="line">library(ggplot2)</span><br><span class="line">ggsave(&apos;plot-again-BRCA1-TCGA-BRCA-cbioportal.png&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="task5某基因在某肿瘤中的生存曲线作图美化"><a class="markdownIt-Anchor" href="#task5某基因在某肿瘤中的生存曲线作图美化"></a> Task5:某基因在某肿瘤中的生存曲线作图美化</h1>
<blockquote>
<p>找到TP53基因在TCGA数据库的乳腺癌数据集的表达量分组看其是否影响生存<br>
提示使用：<a href="http://www.oncolnc.org/" target="_blank" rel="noopener">http://www.oncolnc.org/</a><br>
值得商榷的问题，low和high分组问题，若50：50分组，无差异<br>
个人理解，这里不必平分，可以30：30，也就是就挑高和低的30%，这是可以说明问题的</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rm(list = ls())</span><br><span class="line">options(stringsAsFactors = F)</span><br><span class="line">a=read.table(&apos;BRCA_7157_50_50.csv&apos;,sep = &apos;,&apos;,fill = T,header = T)</span><br><span class="line">#View(a)</span><br><span class="line">dat=a</span><br><span class="line">library(ggplot2)</span><br><span class="line">library(survival)</span><br><span class="line">library(survminer) </span><br><span class="line">table(dat$Status)</span><br><span class="line">dat$Status=ifelse(dat$Status==&apos;Dead&apos;,1,0)</span><br><span class="line">sfit &lt;- survfit(Surv(Days, Status)~Group, data=dat)</span><br><span class="line">sfit</span><br><span class="line">summary(sfit)</span><br><span class="line">ggsurvplot(sfit, conf.int=F, pval=TRUE)</span><br><span class="line">ggsave(&apos;survival_TP53_in_BRCA_TCGA.png&apos;)</span><br></pre></td></tr></table></figure>
<h1 id="task6geo下载表达数据并提取特定的基因做热图要去重复"><a class="markdownIt-Anchor" href="#task6geo下载表达数据并提取特定的基因做热图要去重复"></a> Task6：GEO下载表达数据并提取特定的基因做热图（要去重复）</h1>
<blockquote>
<p>下载数据集GSE17215的表达矩阵并且提取下面的基因画热图<br>
ACTR3B ANLN BAG1 BCL2 BIRC5 BLVRA CCNB1 CCNE1 CDC20 CDC6 CDCA1 CDH3<br>
CENPF CEP55 CXXC5 EGFR ERBB2 ESR1 EXO1 FGFR4 FOXA1 FOXC1 GPR160 GRB7<br>
KIF2C KNTC2 KRT14 KRT17 KRT5 MAPT MDM2 MELK MIA MKI67 MLPH MMP11 MYBL2<br>
MYC NAT1 ORC6L PGR PHGDH PTTG1 RRM2 SFRP1 SLC39A6 TMEM45B TYMS UBE2C UBE2T<br>
GSE17215数据在https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE17215<br>
可知，是U133A的芯片数据,共6个样本<br>
title为Expression data from paclitaxel and salinomycin-treated HMLER breast cancer cells</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">library(hgu133a.db)</span><br></pre></td></tr></table></figure>
<h2 id="有三种方法得到表达数据"><a class="markdownIt-Anchor" href="#有三种方法得到表达数据"></a> 有三种方法得到表达数据</h2>
<h3 id="1下载cel格式文件自己进行处理"><a class="markdownIt-Anchor" href="#1下载cel格式文件自己进行处理"></a> 1.下载.CEL格式文件，自己进行处理</h3>
<h3 id="2手动下载series-matrix-files然后读入"><a class="markdownIt-Anchor" href="#2手动下载series-matrix-files然后读入"></a> 2.手动下载series Matrix Files，然后读入</h3>
<h3 id="3利用r下载表达数据"><a class="markdownIt-Anchor" href="#3利用r下载表达数据"></a> 3.利用R下载表达数据</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">library(GEOquery)</span><br><span class="line">library(GEOquery)</span><br><span class="line">#GEO使用https://www.bioconductor.org/packages/release/bioc/vignettes/GEOquery/inst/doc/GEOquery.html</span><br><span class="line">gse17215 &lt;- getGEO(&apos;GSE17215&apos;,</span><br><span class="line">                   AnnotGPL = F,     ## 注释文件</span><br><span class="line">                   getGPL = F)       ## 平台文件</span><br><span class="line">show(gse17215)</span><br><span class="line">dat &lt;- exprs(gse17215[[1]])</span><br><span class="line">pdata_17215 &lt;- pData(gse17215[[1]])</span><br><span class="line">pdata_17215$`agent:ch1`</span><br><span class="line"></span><br><span class="line">#提取hgu133a包中的probe_id和symbol</span><br><span class="line">ids &lt;- toTable(hgu133aSYMBOL)</span><br><span class="line">dat &lt;- dat[ids$probe_id,]#合并，也可以用merge</span><br><span class="line">#这里有个问题，一共50个基因名，但是得到的是87个探针，也就是有一个gene对应几个探针的情况</span><br><span class="line">#怎么处理？ 取median或者去p最小的,也有取均值的,</span><br><span class="line">#先把median加到ids最后一列</span><br><span class="line">ids$median &lt;- apply(dat, 1, median)</span><br><span class="line">head(ids)</span><br><span class="line">ids &lt;- ids[order(ids$symbol, ids$median, decreasing = T),]</span><br><span class="line">head(ids)</span><br><span class="line">ids_dup &lt;- ids[!duplicated(ids$symbol),]</span><br><span class="line">head(ids_dup)</span><br><span class="line">dat &lt;- dat[ids_dup$probe_id,]</span><br><span class="line">dim(dat)</span><br><span class="line">#这样就得到了去重重复的探针在6个样本中的表达信息，但没有基因名</span><br><span class="line">dat &lt;- as.data.frame(dat)</span><br><span class="line">dat$probe_id &lt;- rownames(dat)</span><br><span class="line">dat_symbol &lt;- merge(dat, ids, by =&quot;probe_id&quot;)</span><br><span class="line">#载入50个基因名</span><br><span class="line">genes &lt;- &apos;ACTR3B ANLN BAG1 BCL2 BIRC5 BLVRA CCNB1 CCNE1 CDC20 CDC6 CDCA1 CDH3 CENPF CEP55 CXXC5 EGFR ERBB2 ESR1 EXO1 FGFR4 FOXA1 FOXC1 GPR160 GRB7 KIF2C KNTC2 KRT14 KRT17 KRT5 MAPT MDM2 MELK MIA MKI67 MLPH MMP11 MYBL2 MYC NAT1 ORC6L PGR PHGDH PTTG1 RRM2 SFRP1 SLC39A6 TMEM45B TYMS UBE2C UBE2T&apos;</span><br><span class="line">genes &lt;- strsplit(genes, &apos; &apos;)[[1]]</span><br><span class="line">genes &lt;- data.frame(genes)</span><br><span class="line">colnames(genes) &lt;- &apos;symbol&apos;</span><br><span class="line">genes_expr &lt;- merge(genes, dat_symbol, by =&apos;symbol&apos;)</span><br><span class="line">#至此完成了探针过滤，加基因名等操作</span><br><span class="line">#取对数</span><br><span class="line">genes_expr &lt;- log2(dat+1)</span><br><span class="line">heat_expr &lt;- genes_expr[,-c(2,9)]</span><br><span class="line">rownames(heat_expr) &lt;- heat_expr$symbol </span><br><span class="line">heat_expr &lt;- heat_expr[,-1]</span><br><span class="line">heat_expr &lt;- log2(heat_expr+1)</span><br><span class="line">pheatmap::pheatmap(heat_expr, scale = &apos;row&apos;)</span><br><span class="line">ggcorrplot::ggcorrplot(cor(heat_expr))</span><br></pre></td></tr></table></figure>
<h1 id="task7geo下载表达矩阵做样本的相关性热图需要标记样本分组信息"><a class="markdownIt-Anchor" href="#task7geo下载表达矩阵做样本的相关性热图需要标记样本分组信息"></a> Task7:GEO下载表达矩阵做样本的相关性热图，需要标记样本分组信息</h1>
<blockquote>
<p>作业7<br>
下载数据集GSE24673的表达矩阵计算样本的相关性并且绘制热图，需要标记上样本分组信息<br>
数据地址https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE24673</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rm(list=ls())</span><br><span class="line">options(stringsAsFactors = F)   </span><br><span class="line">gse24673 &lt;- getGEO(&apos;GSE24673&apos;,</span><br><span class="line">                   AnnotGPL = F,     ## 注释文件</span><br><span class="line">                   getGPL = F)       ## 平台文件</span><br><span class="line">show(gse24673)</span><br><span class="line">dat &lt;- exprs(gse24673[[1]])</span><br><span class="line">pdata_24673 &lt;- pData(gse24673[[1]]) </span><br><span class="line">pdata_24673 &lt;- pdata_24673$source_name_ch1</span><br><span class="line">pdata_24673 &lt;- data.frame(Group = pdata_24673)</span><br><span class="line">#添加分组信息</span><br><span class="line">rownames(pdata_24673) &lt;- colnames(cor_dat)</span><br><span class="line">pheatmap::pheatmap(cor_dat, annotation_col=pdata_24673)</span><br></pre></td></tr></table></figure>
<h1 id="task8-找到芯片对应平台的注释包并进行安装"><a class="markdownIt-Anchor" href="#task8-找到芯片对应平台的注释包并进行安装"></a> Task8： 找到芯片对应平台的注释包并进行安装</h1>
<blockquote>
<p>找到 GPL6244 platform of Affymetrix Human Gene 1.0 ST Array 对应的R的bioconductor注释包，并且安装它！<br>
参考http://www.bio-info-trainee.com/1399.html</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">options()$repos</span><br><span class="line">options()$BioC_mirror </span><br><span class="line">options(BioC_mirror=&quot;https://mirrors.ustc.edu.cn/bioc/&quot;)</span><br><span class="line">options(&quot;repos&quot; = c(CRAN=&quot;https://mirrors.tuna.tsinghua.edu.cn/CRAN/&quot;))</span><br><span class="line">BiocManager::install(&quot;hugene10sttranscriptcluster.db&quot;,ask = F,update = F)</span><br><span class="line">options()$repos</span><br><span class="line">options()$BioC_mirror</span><br></pre></td></tr></table></figure>
<h1 id="task9geo下载表达矩阵所有样本中挑选所需要的探针"><a class="markdownIt-Anchor" href="#task9geo下载表达矩阵所有样本中挑选所需要的探针"></a> Task9：GEO下载表达矩阵，所有样本中挑选所需要的探针</h1>
<blockquote>
<p>下载数据集GSE42872的表达矩阵，并且分别挑选出所有样本的(平均表达量/sd/mad/)最大的探针，<br>
并且找到它们对应的基因。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">rm(list=ls())</span><br><span class="line">options(stringsAsFactors = F)   </span><br><span class="line">gse42872 &lt;- getGEO(&apos;GSE42872&apos;,</span><br><span class="line">                   AnnotGPL = F,     ## 注释文件</span><br><span class="line">                   getGPL = F)       ## 平台文件</span><br><span class="line">show(gse42872)</span><br><span class="line">dat &lt;- as.data.frame(exprs(gse42872[[1]]))</span><br><span class="line">pdata_42872 &lt;- pData(gse42872[[1]]) </span><br><span class="line">pdata_42872 &lt;- pdata_42872$source_name_ch1</span><br><span class="line">pdata_42872 &lt;- data.frame(Group = pdata_42872)</span><br><span class="line"></span><br><span class="line">max_mean &lt;- names(sort(apply(dat,1, mean), decreasing = T))[1]</span><br><span class="line">max_sd &lt;- names(sort(apply(dat,1, sd), decreasing = T))[1]</span><br><span class="line">max_mad &lt;- names(sort(apply(dat,1, mad), decreasing = T))[1]</span><br><span class="line">str(max_max)</span><br><span class="line">library(hugene10sttranscriptcluster.db)</span><br><span class="line">list(hugene10sttranscriptcluster.db)</span><br><span class="line">###find the corresponding genes for the probes</span><br><span class="line">ids &lt;- toTable(hugene10sttranscriptclusterSYMBOL)</span><br><span class="line">ids[match(max_mad, ids$probe_id),]</span><br><span class="line">#或者</span><br><span class="line">select(hugene10sttranscriptcluster.db,</span><br><span class="line">       keys = c(max_sd, max_mad, max_mean),</span><br><span class="line">       columns = c(&quot;SYMBOL&quot;),</span><br><span class="line">       keytype = &quot;PROBEID&quot;)</span><br><span class="line">##注意，max_mad探针对应着很多基因名</span><br></pre></td></tr></table></figure>
<h1 id="10-task10"><a class="markdownIt-Anchor" href="#10-task10"></a> 10 Task10</h1>
<blockquote>
<p>这部分内容参考http://www.bio-info-trainee.com/bioconductor_China/software/limma.html<br>
下载数据集GSE42872的表达矩阵，并且根据分组使用limma做差异分析，<br>
得到差异结果矩阵</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">library(GEOquery)</span><br><span class="line">rm(list=ls())</span><br><span class="line">options(stringsAsFactors = F)   </span><br><span class="line">gse42872 &lt;- getGEO(&apos;GSE42872&apos;, GSEMatrix = TRUE,</span><br><span class="line">                   AnnotGPL = F,     ## 注释文件</span><br><span class="line">                   getGPL = F)       ## 平台文件</span><br><span class="line">show(gse42872)</span><br><span class="line">dat &lt;- as.data.frame(exprs(gse42872[[1]]))</span><br><span class="line">pdata_42872 &lt;- pData(gse42872[[1]]) </span><br><span class="line">pdata_42872 &lt;- pdata_42872$title</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">group &lt;- unlist(lapply(pdata_42872, function(x)</span><br><span class="line">&#123;</span><br><span class="line">  strsplit(x,&apos; &apos;)[[1]][4]</span><br><span class="line">&#125;</span><br><span class="line">  ))</span><br><span class="line">#pdata_42872 &lt;- data.frame(Group = pdata_42872)</span><br><span class="line">library(hugene10sttranscriptcluster.db)</span><br><span class="line">ids &lt;- toTable(hugene10sttranscriptclusterSYMBOL)</span><br><span class="line">dim(ids)</span><br><span class="line">dim(dat)</span><br><span class="line"># &gt; dim(ids)</span><br><span class="line"># [1] 19827     2</span><br><span class="line"># &gt; dim(dat)</span><br><span class="line"># [1] 33297     6</span><br><span class="line">#很多探针没有注释信息，进行过滤,/可以用merge但是需要加列</span><br><span class="line">dat_filter &lt;- dat[match(ids$probe_id,rownames(dat)),]</span><br><span class="line">dim(dat_filter)</span><br><span class="line">#用%in%进行筛选</span><br><span class="line">dat_filter2 &lt;- dat[rownames(dat) %in% ids$probe_id,]</span><br><span class="line"># &gt; dim(dat_filter)</span><br><span class="line"># [1] 19827     6</span><br><span class="line">#dat_filter is the expression matrix</span><br></pre></td></tr></table></figure>
<h2 id="差异表达分析"><a class="markdownIt-Anchor" href="#差异表达分析"></a> 差异表达分析</h2>
<p>需要分组矩阵（design），比较矩阵（contrast）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">library(limma)</span><br><span class="line">##########分组矩阵design，group中的说明。1代表是。用于每张芯片的RNA样本分类</span><br><span class="line">design &lt;- model.matrix(~0+factor(group))</span><br><span class="line">colnames(design) &lt;- levels(factor(group))</span><br><span class="line">rownames(design) &lt;- colnames(dat_filter)</span><br><span class="line">design</span><br><span class="line"># Control Vemurafenib</span><br><span class="line"># GSM1052615       1           0</span><br><span class="line"># GSM1052616       1           0</span><br><span class="line"># GSM1052617       1           0</span><br><span class="line"># GSM1052618       0           1</span><br><span class="line"># GSM1052619       0           1</span><br><span class="line"># GSM1052620       0           1</span><br><span class="line">###############比较矩阵</span><br><span class="line">colnames(design) &lt;- levels(factor(group))</span><br><span class="line">rownames(design) &lt;- colnames(dat_filter)</span><br><span class="line">design</span><br><span class="line">#再做一个比较矩阵【一般是case比control】，规定实验组和对照组并定义谁比谁</span><br><span class="line">contrast.matrix&lt;-makeContrasts(paste0(unique(group),collapse = &quot;-&quot;),levels = design)</span><br><span class="line">#或者下面。注意是Vemurafenib/Control</span><br><span class="line">contrast.matrix_2 &lt;- makeContrasts(&quot;Vemurafenib-Control&quot; ,levels = design)</span><br></pre></td></tr></table></figure>
<h2 id="筛选差异基因degs"><a class="markdownIt-Anchor" href="#筛选差异基因degs"></a> 筛选差异基因DEGs</h2>
<p>###分步进行1，这步用到实验设计矩阵</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fit &lt;- lmFit(dat_filer, design)</span><br></pre></td></tr></table></figure>
<p>###分步进行2，用到比较矩阵</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fit2 &lt;- contrasts.fit(fit, contrast.matrix)</span><br><span class="line">fit2 &lt;- eBayes(fit2)</span><br></pre></td></tr></table></figure>
<p>###分步进行3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tem_output &lt;- topTable(fit2, coef = 1, n= Inf)</span><br><span class="line">mydegs &lt;- na.omit(tem_output)</span><br></pre></td></tr></table></figure>
<p>###写成函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">deg&lt;- function(dat_filter,design,contrast)&#123;</span><br><span class="line">  ##step1</span><br><span class="line">  fit &lt;- lmFit(dat_filter,design)#用到实验设计矩阵</span><br><span class="line">  ##step2</span><br><span class="line">  fit2 &lt;- contrasts.fit(fit, contrast) #用到比较矩阵</span><br><span class="line">  fit2 &lt;- eBayes(fit2)  </span><br><span class="line">  ##step3</span><br><span class="line">  mtx = topTable(fit2, coef=1, n=Inf)</span><br><span class="line">  deg_mtx = na.omit(mtx) </span><br><span class="line">  return(deg_mtx)</span><br><span class="line">&#125;</span><br><span class="line">deg_mtx &lt;- DEG(dat_filter,design,contrast) #得到全部的差异基因矩阵</span><br><span class="line">head(DEG_mtx)</span><br></pre></td></tr></table></figure>
<h2 id="下面和symbole对应"><a class="markdownIt-Anchor" href="#下面和symbole对应"></a> 下面和symbole对应</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library(hugene10sttranscriptcluster.db)</span><br><span class="line">ids &lt;- toTable(hugene10sttranscriptclusterSYMBOL)</span><br><span class="line">deg_mtx$probe_id &lt;- rownames(deg_mtx)</span><br><span class="line">deg_mtx &lt;- merge(ids,deg_mtx, by = &apos;probe_id&apos;)</span><br><span class="line">write.csv(deg_mtx, &apos;GSE42872_DEGs_limma.csv&apos;, quote = F)</span><br></pre></td></tr></table></figure>

      
    </div>

    

    
    
    

    

    
      
    
    
      <div>
        <div id="reward-container">
  <div></div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">

    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/wechat.jpg" alt="Kelly 微信支付">
        <p>微信支付</p>
      </div>
    
      
      
        
      
      <div style="display: inline-block">
        <img src="/images/alipay.jpg" alt="Kelly 支付宝">
        <p>支付宝</p>
      </div>
    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/R/" rel="tag"># R</a>
          
            <a href="/tags/统计/" rel="tag"># 统计</a>
          
            <a href="/tags/生物信息学/" rel="tag"># 生物信息学</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/27/ggstatsplot包的安装和简单使用/" rel="next" title="ggstatsplot包的安装和简单使用">
                <i class="fa fa-chevron-left"></i> ggstatsplot包的安装和简单使用
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/28/github+hexo+个人域名建立个人网站/" rel="prev" title="github+hexo+个人域名建立个人网站">
                github+hexo+个人域名建立个人网站 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80Mzk1OS8yMDQ5NQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Kelly">
            
              <p class="site-author-name" itemprop="name">Kelly</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/hyinli" title="GitHub &rarr; https://github.com/hyinli" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:kkyinli@gmail.com" title="E-Mail &rarr; mailto:kkyinli@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/51a71446d509" title="https://www.jianshu.com/u/51a71446d509" rel="noopener" target="_blank">Y大宽</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ucco.net" title="http://www.ucco.net" rel="noopener" target="_blank">k2</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.enjoytoshare.club/" title="https://blog.enjoytoshare.club/" rel="noopener" target="_blank">Wugenqiang</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#task1-通过r注释包从ensemble到symbol"><span class="nav-text"> Task1: 通过R注释包从ensemble到symbol</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#method1for循环"><span class="nav-text"> Method1:for循环</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#method2apply函数"><span class="nav-text"> Method2:apply函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#task2由探针找到对应的基因名"><span class="nav-text"> Task2:由探针找到对应的基因名</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#task3-找某个基因在表达矩阵中的值并分组绘图"><span class="nav-text"> Task3 找某个基因在表达矩阵中的值并分组绘图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#task4对任意肿瘤的任意基因进行分类做图用cbioportal"><span class="nav-text"> Task4:对任意肿瘤的任意基因进行分类做图（用cBioPortal）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#task5某基因在某肿瘤中的生存曲线作图美化"><span class="nav-text"> Task5:某基因在某肿瘤中的生存曲线作图美化</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#task6geo下载表达数据并提取特定的基因做热图要去重复"><span class="nav-text"> Task6：GEO下载表达数据并提取特定的基因做热图（要去重复）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#有三种方法得到表达数据"><span class="nav-text"> 有三种方法得到表达数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1下载cel格式文件自己进行处理"><span class="nav-text"> 1.下载.CEL格式文件，自己进行处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2手动下载series-matrix-files然后读入"><span class="nav-text"> 2.手动下载series Matrix Files，然后读入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3利用r下载表达数据"><span class="nav-text"> 3.利用R下载表达数据</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#task7geo下载表达矩阵做样本的相关性热图需要标记样本分组信息"><span class="nav-text"> Task7:GEO下载表达矩阵做样本的相关性热图，需要标记样本分组信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#task8-找到芯片对应平台的注释包并进行安装"><span class="nav-text"> Task8： 找到芯片对应平台的注释包并进行安装</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#task9geo下载表达矩阵所有样本中挑选所需要的探针"><span class="nav-text"> Task9：GEO下载表达矩阵，所有样本中挑选所需要的探针</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#10-task10"><span class="nav-text"> 10 Task10</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#差异表达分析"><span class="nav-text"> 差异表达分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#筛选差异基因degs"><span class="nav-text"> 筛选差异基因DEGs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下面和symbole对应"><span class="nav-text"> 下面和symbole对应</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kelly</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">61k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">55 分钟</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.1.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.1"></script>

  <script src="/js/motion.js?v=7.1.1"></script>



  
  


  <script src="/js/affix.js?v=7.1.1"></script>

  <script src="/js/schemes/pisces.js?v=7.1.1"></script>




  
  <script src="/js/scrollspy.js?v=7.1.1"></script>
<script src="/js/post-details.js?v=7.1.1"></script>



  


  <script src="/js/next-boot.js?v=7.1.1"></script>


  

  

  

  


  
    <script>
  window.livereOptions = {
    refer: '2019/04/27/生信技能树R作业中级/'
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
</script>

  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
<script>
if ($('body').find('div.pdf').length) {
  $.ajax({
    type: 'GET',
    url: '//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js',
    dataType: 'script',
    cache: true,
    success: function() {
      $('body').find('div.pdf').each(function(i, o) {
        PDFObject.embed($(o).attr('target'), $(o), {
          pdfOpenParams: {
            navpanes: 0,
            toolbar: 0,
            statusbar: 0,
            pagemode: 'thumbs',
            view: 'FitH'
          },
          PDFJS_URL: '/lib/pdf/web/viewer.html',
          height: $(o).attr('height') || '500px'
        });
      });
    },
  });
}
</script>


  

  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>


  

  

  

  

  

  

  

  

</body>
</html>
